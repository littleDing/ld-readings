# Bid-aware Gradient Descent for Unbiased Learning with Censored Data in Display Advertising 
[pdf](https://www.kdd.org/kdd2016/papers/files/adp0028-zhangA.pdf)

## tags
* SJTU
* unbiased learning
* cencored data
* RTB
* KDD 2016
* click through rate
* missing data

## Highlights
1. 引入生存分析理论，对给定出价的胜出率进行合理的无偏估计，合理利用竞价失败的数据；
1. 用胜出率为点击率预估样本反向加权；出价策略也做了类似的处理（目前没看懂@20200212）；
1. 2015-09在雅虎DSP上投放实验，点击率AUC+2.97%，线上cpc-9.3%，CTR+42%，clk+10%；

## Problem
1. DSP在参与竞价的时候，要求在整个流量空间上预估CTR和CVR，但只能收集到曝光后的数据，会存在样本分布有偏，价格高的样本因为胜出概率大，收集到的概率也大；
1. 传统的机器学习有应对missing data的方法，但是需要一个先验；折中的办法是做一些随机出价；

! [bias](bid-aware/figure1-biased.png)

## Related work
1. 用户反馈预估，也就是CTR/CVR预估；
1. RTB优化，一般来说二价拍卖最优策略是说真话，但加上容量和预算限制之后就不是了；在真实出价的基础上，会有一些不同的动态折价策略；
1. 有偏的离线评估，在线调优模型昂贵且危险，用历史数据来校正会便宜和安全一些；当数据采样模型已知且稳定，并且样本空间探索充分的情况下，可以用剔除采样的办法；也有人用强化学习；
1. missing-data学习，是推荐系统的经典问题，经常遇到只有隐式反馈的问题，一般通过各种负样本采样的办法解决；

## Approach
### 基本的分布
通篇的问题都来自于 Q(x) = P(x) * win(b)，即观察到的数据其实是受出价带来的胜出率控制的有偏数据；

### 胜出率的无偏估计
1. 很直观的，如果只用观测到的数据，则出价b的胜出率可以用数数来解决，win0(b) = count(price < b) / #ins ；
1. 但存在大量的数据是竞价失败的，这些样本上的计费是高于当前出价的，也就是部分高价数据丢失，使得win0其实是一个乐观的估计，一般都高估了胜出率；
1. 但至少可以知道price>=b，这个情况和生存分析里面的，病人没有在实验观测期内死亡，但是我们并不知道病人真实死亡日期是类似的；
1. 于是引入了生存分析里的KMPL方法对胜出率进行估计，win1(b) = 1 - product( (n[j] - d[j])/n[j] )；
1. 具体公式推导不进一步展开了（目前没看懂@20200212）；

### TASK1：修正点击率模型
1. 不引入竞价失败数据时，点击率预估模型的训练数据都是等权的，记为BIAS；
1. 但实际上训练数据来自于分布Q而不是真实的分布P，因此要通过win进行反向调权，如果一个曝光样本的当次出价实际上只对应了10%的胜出率，应该给这条样本乘上十倍的权重；
1. 用win0作为调权依据时，记为UOMP；用win1时，记为KMMP；
1. 完美的不计成本方法，是用全部数据来做的，记为FULL；

### TASK2：修正出价策略
同样可以引入胜出率来修正（目前没看懂@20200212）；

## Experiments
### 线下模拟
1. iPinyou数据集，bid=64.75M，shw=19.5M，clk=14.79K，最后三天作为测试集；
1. TukMob数据集，shw=3M，clk=96.45K，按时间序列最后1/6数据作为测试数据；
1. 对胜出率的模拟印证了之前对胜出率的推演，UOMP会严重乐观，KMMP则非常接近于FULL，皮尔森相关系数和KL散度的统计也支持这个观点；
1. 引入修正的CTR模型都比BIAS强；不过这个数据看起来不同计划之间的方差非常大，auc范围从0.59到0.99都有；
1. 同样的在出价上面的修正也有显著正向；

### 线上AB测试
1. 在雅虎DSP上进行了投放实验，50/50的切分流量和预算，只比较了KMMP和BIAS模型的效果；
1. 点击率模型的AUC+2.97%；
1. 9个投放计划都取得正收益，合计cpc-9.3%，CTR+42%，clk+10%；

## 读后记 
1. 需要补一把生存分析理论；
1. 论文的公式都是基于连续空间概率来抽象和推导的，按离散概率空间来推演的话，会不会更易懂一些？
1. 最优出价策略和预估模型的控制变量实验没有给出，实际上并不知道哪一个因素对最终的效果贡献更大；
1. 10%的成本下降和点击量上升是非常显著的，作为四年前发论文、五年前做实验的技术，目前应该是各大DSP的标配了；


## References
[pdf](https://www.kdd.org/kdd2016/papers/files/adp0028-zhangA.pdf)

## logs
* [ 2020-02-12 00:59:38 ] end
* [ 2020-02-11 22:49:02 ] resume
* [ 2019-12-23 09:43:07 ] pause
* [ 2019-12-23 09:17:25 ] resume
* [ 2019-12-22 22:50:50 ] pause
* [ 2019-12-22 22:07:49 ] resume
* [ 2019-12-18 09:57:22 ] pause
* [ 2019-12-18 09:08:51 ] begin


